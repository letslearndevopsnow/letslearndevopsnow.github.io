---
layout:     post
title:      "AWX TOWER"
subtitle:   " How To Install AWX Tower On Ubuntu 20.04 LTS"
date:       2021-07-08 3:00:00
author:     "Thaung Htike Oo"
header-img: img/black.jpg
catalog: true
tags:
    - Ansible
    - IAC
---

<h2> Ansible မိတ်ဆက် </h2>
<p>
ကျွန်တော်ဒီနေ့ ရေးမယ့် ခေါင်းစဥ်ကတော့ AWX အကြောင်းပဲဖြစ်ပါတယ်ခင်ဗျာ။ AWX အကြောင်းကို မစတင်ခင်မှာ Configuration Management Tools တွေထဲက နာမည်ကြီးဖြစ်တဲ့ Ansible ကိုတော့သိကြမယ်လို့ထင်ပါတယ်။ Ansible ဆိုတာ ကျွန်တော့်တို့ရဲ့ ရုံးတွေ အလုပ်တွေရဲ့ servers တွေအများကြီးပေါ်မှာ ထပ်တလဲလဲ လုပ်ရမယ့် configuraion tasks တွေအတွက် အချိန်ကုန်သက်သာဖို့ လူပင်ပန်းသက်သာစေဖို့ automate လုပ်ပေးမယ့် Tool တစ်ခုဖြစ်ပါတယ်။
Configuration Tasks တွေပြီးမြှောက်ဖို့အတွက် Ansible Ad-Hoc Commands တွေ run ခြင်း (သို့) Playbook တွေရေးပြီး run ခြင်းဖြင့် automate လုပ်ကြရပါတယ်။ 
</p>
<p>
နောက်ပိုင်းမှာ Redhat ကနေပြီးတော့ Visualization အတွက် Dashboard တွေ ၊ Authorization အတွက် RBAC တွေ ၊ Job Schedulling တွေနဲ့ Centralized Logging စသည့် features တွေပါဝင်လာတဲ့ Redhat Ansible Tower ကို တီထွင်ခဲ့ကြပါတယ်။ ဒါပေမယ့် သူက free မရပါဘူး။ AWX ဆိုတာက တစ်နည်းအားဖြင့် Redhat Ansible Tower ရဲ့ open-source version ဖြစ်ပါတယ်။ ဒါကြောင့် ဒီနေ့မှာ AWX ကို ubuntu server တစ်ခုပေါ်မှာ install လုပ်ပုံကို ကျွန်တော်နဲ့အတူ စမ်းကြည့်လိုက်ရအောင်နော်။
</p>

<h2> Prerequities </h2>

```bash
4 GB of RAM
3.4 GHz CPU with 2 Cores
Hard disk space 20 GB
Internet Connection
```
<h2> Installation Steps </h2>

ပထမဆုံးအနေနဲ့ ubuntu server ထဲကို login ဝင်ပြီး terminal ကနေ apt update ကို run ပေးပါ။
```bash
sudo apt update -y
```
နောက်တစ်ဆင့် အနေနဲ့ကတော့ docker ကို install လုပ်ပေးရမှာဖြစ်ပါတယ်ခင်ဗျာ။ အောက်က commands တွေကို terminal မှာ run ပေးပါ။
```bash
sudo apt install docker.io -y
sudo systemctl status docker
sudo groupadd docker
sudo usermod -aG docker $USER
newgrp docker 
```
တတိယအဆင့်အနေနဲ့ကတော့ docker-compose ကို install လုပ်ပေးရမှာဖြစ်ပြတယ်။
```bash
sudo curl -L "https://github.com/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose
docker-compose --version
```
docker နဲ့ docker-compose သွင်းပြီးတဲ့အခါမှာတော့ ansible ကို install ပေးရပါမယ်။
```bash
sudo apt install ansible -y
ansible --version
```
node နဲ့ npm ကိုလည်း install ပေးဖို့လိုပါတယ်။
```bash
sudo apt install nodejs npm -y
sudo npm install npm --global
```
လိုအပ်တာတွေအားလုံး install ပြီးသွားတဲ့အခါ AWX ကို စပြီး install လို့ရပါပြီ။
```bash
sudo apt install -y python3-pip git pwgen
```
နောက်တစ်ဆင့်မှာတော့ docker-compose pip module ကို install ပေးရမှာဖြစ်ပါတယ်။ docker-compose version နဲ့ pip module version ကတူရပါမယ်။
```bash
docker-compose --version
sudo pip3 install docker-compose==1.29.2
```
ပြီးသွားရင်တော့ ကျွန်တော်တို့တွေ github က AWX zip file ကို wget command လေးနဲ့ download လုပ်ပေးပါ။ download ပြီးရင် zip file ကို unzip ပြန်ဖြည်ပေးပါ။
```bash
wget https://github.com/ansible/awx/archive/17.1.0.zip
unzip 17.1.0.zip
cd awx-17.1.0 /installer
```
နောက်တစ်ဆင့်ကတော့ pwgen ကိုသုံးပြီး secret တစ်ခုကို အောက်ကအတိုင်း generate ပေးလိုက်ပါ။ အဲ့ဒီ ရလာတဲ့ secret key ကို admin user တစ်ယောက် create တဲ့အခါသုံးရမှာဖြစ်ပါတယ်။
```bash
 pwgen -N 1 -s 30
 ```
ဒီအဆင့်မှာတော့ admin user တစ်ယောက် ဆောက်ပေးရမှာဖြစ်ပါတယ်။ username က admin ဖြစ်ပြီး password ကတော့ မိမိကြိုက်နှစ်သက်ရာကို ပေးနိုင်ပါတယ်။ secret key ကတော့ အပေါ်က pwgen နဲ့ generate လို့ရလာတဲ့ key ပဲဖြစ်ပါတယ်။
```bash
vim inventory
admin_user=admin
admin_password=Th@861998
secret_key=lKjpI3Hdj2PWlp8De6g2pDj9e5dU5e
```
* Run playbook to install ansible aws
```bash
sudo su -
cd /home/thaunghtikeoo/awx-*/installer/
kill service running on port 80 (i.e nginx)
ansible-playbook -i inventory install.yml
```

* create credential.
```bash
type == machine
username == username for ssh-copy-id ( root )
ssh_private_key == awx node's private key
privilege_escalation_method == sudo
```
![Image of credentials](https://github.com/tho861998/ansible/blob/master/images/Screenshot%20from%202021-06-24%2015-46-15.png)

* add a host .
```bash
name == as you like
variable ---> ansible_host: node_ip
```
* create inventory
```bash
name == as you like
org == your org
click save
clock hosts to add hosts 
name == as you like
variable ---> ansible_host: node_ip
save
click groups to add host to a group 
select group or create new gp
```
* add your project
```bash
select git
add your git repo
keep blank for main branch 
save
click job templates
```
* add your job templates
```bash
inventory == your created inventory
project == your created prj
playbook == choose one
credentials == created credentials with ssh private key
save and launch to start creating playbook
```


